<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#b100b2><meta name=theme-color content=#b100b2><title>Quick and Dirty Twitter API in Python</title><meta name=description content="I am Dr Martin Chorley. I am a lecturer at the School of Computer Science & Informatics, Cardiff University.I'm programme leader for the MSc in Computational Journalism, and also senior personal tutor for all taught postgraduate students. I mainly do work that falls under the umbrella of the Mobile and Social Computing group.
"><link rel=icon href=/img/favicon.png><link href="https://fonts.googleapis.com/css?family=Roboto|Scope+One" rel=stylesheet><link rel=stylesheet type=text/css href=/css/main.css></head><body><header><div class=social><ul><li><a href=https://www.twitter.com/martinjc class="icon twitter" title=Twitter><svg viewBox="0 0 512 512"><path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"/></svg><!--[if lt IE 9]><em>Twitter</em><![endif]--></a></li><li><a href=mailto:ChorleyMJ@Cardiff.ac.uk class="icon email" title=Email><svg viewBox="0 0 512 512"><path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li><li><a href=https://www.facebook.com/martin.chorley class="icon facebook" title=Facebook><svg viewBox="0 0 512 512"><path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z"/></svg><!--[if lt IE 9]><em>Facebook</em><![endif]--></a></li><li><a href=https://www.github.com/martinjc class="icon github" title=GitHub><svg viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li><li><a href=https://www.instagram.com/martinjam class="icon instagram" title=Instagram><svg viewBox="0 0 512 512"><g><path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z"/><path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z"/><circle cx=351.5 cy=160.5 r=21.5 /></g></svg><!--[if lt IE 9]><em>Instagram</em><![endif]--></a></li><li><a href=https://www.last.fm/user/takitomouse class="icon lastfm" title=Last.fm><svg viewBox="0 0 512 512"><path d="M230.104 336.568l-13.607-36.988c0 0-22.11 24.66-55.268 24.66 -29.341 0-50.172-25.512-50.172-66.328 0-52.293 26.359-71.001 52.297-71.001 37.412 0 49.316 24.234 59.522 55.273l13.607 42.518c13.603 41.236 39.113 74.402 112.666 74.402 52.727 0 88.437-16.155 88.437-58.672 0-34.438-19.56-52.297-56.125-60.802l-27.209-5.951c-18.707-4.252-24.233-11.906-24.233-24.659 0-14.456 11.478-22.96 30.189-22.96 20.406 0 31.458 7.653 33.162 25.935l42.516-5.103c-3.402-38.263-29.761-53.996-73.127-53.996 -38.266 0-75.68 14.456-75.68 60.799 0 28.912 14.029 47.197 49.315 55.697l28.916 6.801c21.683 5.104 28.908 14.031 28.908 26.363 0 15.73-15.305 22.107-44.218 22.107 -42.941 0-60.794-22.534-70.999-53.574l-14.032-42.513c-17.854-55.271-46.342-75.68-102.892-75.68 -62.499-0.001-95.663 39.538-95.663 106.715 0 64.628 33.164 99.489 92.689 99.489C207.141 359.1 230.104 336.568 230.104 336.568L230.104 336.568z"/></svg><!--[if lt IE 9]><em>Last.fm</em><![endif]--></a></li><li><a href=https://uk.linkedin.com/in/martinchorley class="icon linkedin" title=LinkedIn><svg viewBox="0 0 512 512"><path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z"/></svg><!--[if lt IE 9]><em>LinkedIn</em><![endif]--></a></li></ul></div><nav><ul>|<li><a href=/ >home</a> |</li><li><a href=/blog>blog</a> |</li><li><a href=/research>research</a> |</li><li><a href=/publications>publications</a> |</li><li><a href=/teaching>teaching</a> |</li></ul></nav></header><div class=wrapper><article class=blogpost><a class=post__back href=/blog/ >&lt;-- back</a><h1 class=post__title>Quick and Dirty Twitter API in Python</h1><p class=author><span class=date>November 19, 2014</span> - by martin</p><div class=content ?><p><strong>QUICK DISCLAIMER: this is a quick and dirty solution to a problem, so may not represent best coding practice, and has absolutely no error checking or handling. Use with caution…</strong></p><p>A recent project has needed me to scrape some data from Twitter. I considered using <a href=https://github.com/tweepy/tweepy>Tweepy</a>, but as it was a project for the <a href=compj.cs.cf.ac.uk>MSc in Computational Journalism</a>, I thought it would be more interesting to write our own simple Twitter API wrapper in Python.</p><p>The code presented here will allow you to make any API request to Twitter that uses a GET request, so is really only useful for getting data <em>from</em> Twitter, not sending it <em>to</em> Twitter. It is also only for using with the REST API, not the streaming API, so if you’re looking for realtime monitoring, this is not the API wrapper you’re looking for. This API wrapper also uses a single user’s authentication (yours), so is not setup to allow other users to use Twitter through your application.</p><p>The first step is to get some access credentials from Twitter. Head over to <a href=https://apps.twitter.com/ >https://apps.twitter.com/</a> and register a new application. Once the application is created, you’ll be able to access its details. Under ‘Keys and Access Tokens’ are four values we’re going to need for the API - the  <code class=highlighter-rouge>Consumer Key</code> and <code class=highlighter-rouge>Consumer Secret</code>, and the <code class=highlighter-rouge>Access Token</code> and <code class=highlighter-rouge>Access Token Secret</code>. Copy all four values into a new python file, and save it as ‘<code class=highlighter-rouge>_credentials.py</code>’. Once we have the credentials, we can write some code to make some API requests!</p><p>First, we define a Twitter API object that will carry out our API requests. We need to store the API url, and some details to allow us to throttle our requests to Twitter to fit inside their rate limiting.</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>Twitter_API</span><span class=p>:</span>

 <span class=k>def</span> <span class=nf>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>

   <span class=c># URL for accessing API</span>
   <span class=n>scheme</span> <span class=o>=</span> <span class=s>"https://"</span>
   <span class=n>api_url</span> <span class=o>=</span> <span class=s>"api.twitter.com"</span>
   <span class=n>version</span> <span class=o>=</span> <span class=s>"1.1"</span>

   <span class=bp>self</span><span class=o>.</span><span class=n>api_base</span> <span class=o>=</span> <span class=n>scheme</span> <span class=o>+</span> <span class=n>api_url</span> <span class=o>+</span> <span class=s>"/"</span> <span class=o>+</span> <span class=n>version</span>

   <span class=c>#</span>
   <span class=c># seconds between queries to each endpoint</span>
   <span class=c># queries in this project limited to 180</span>
   <span class=c># per 15 minutes</span>
   <span class=n>query_interval</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=mi>15</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span><span class=o>/</span><span class=p>(</span><span class=mi>175</span><span class=p>)</span>

   <span class=c>#</span>
   <span class=c># rate limiting timer</span>
   <span class=bp>self</span><span class=o>.</span><span class=n>__monitor</span> <span class=o>=</span> <span class=p>{</span><span class=s>'wait'</span><span class=p>:</span><span class=n>query_interval</span><span class=p>,</span>
     <span class=s>'earliest'</span><span class=p>:</span><span class=bp>None</span><span class=p>,</span>
     <span class=s>'timer'</span><span class=p>:</span><span class=bp>None</span><span class=p>}</span></code></pre></figure><p>We add a rate limiting method that will make our API sleep if we are requesting things from Twitter too fast:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=c>#</span>
<span class=c># rate_controller puts the thread to sleep</span>
<span class=c># if we're hitting the API too fast</span>
<span class=k>def</span> <span class=nf>__rate_controller</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>monitor_dict</span><span class=p>):</span>

 <span class=c>#</span>
 <span class=c># join the timer thread</span>
 <span class=k>if</span> <span class=n>monitor_dict</span><span class=p>[</span><span class=s>'timer'</span><span class=p>]</span> <span class=ow>is</span> <span class=ow>not</span> <span class=bp>None</span><span class=p>:</span>
 <span class=n>monitor_dict</span><span class=p>[</span><span class=s>'timer'</span><span class=p>]</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>

 <span class=c># sleep if necessary</span>
 <span class=k>while</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>monitor_dict</span><span class=p>[</span><span class=s>'earliest'</span><span class=p>]:</span>
   <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>monitor_dict</span><span class=p>[</span><span class=s>'earliest'</span><span class=p>]</span> <span class=o>-</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>

 <span class=c># work out then the next API call can be made</span>
 <span class=n>earliest</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>+</span> <span class=n>monitor_dict</span><span class=p>[</span><span class=s>'wait'</span><span class=p>]</span>
 <span class=n>timer</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Timer</span><span class=p>(</span> <span class=n>earliest</span><span class=o>-</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span> <span class=k>lambda</span><span class=p>:</span> <span class=bp>None</span> <span class=p>)</span>
 <span class=n>monitor_dict</span><span class=p>[</span><span class=s>'earliest'</span><span class=p>]</span> <span class=o>=</span> <span class=n>earliest</span>
 <span class=n>monitor_dict</span><span class=p>[</span><span class=s>'timer'</span><span class=p>]</span> <span class=o>=</span> <span class=n>timer</span>
 <span class=n>monitor_dict</span><span class=p>[</span><span class=s>'timer'</span><span class=p>]</span><span class=o>.</span><span class=n>start</span><span class=p>()</span></code></pre></figure><p>The Twitter API requires us to supply authentication headers in the request. One of these headers is a signature, created by encoding details of the request. We can write a function that will take in all the details of the request (method, url, parameters) and create the signature:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=c>#</span>
<span class=c># make the signature for the API request</span>
<span class=k>def</span> <span class=nf>get_signature</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=p>):</span>

 <span class=c># escape special characters in all parameter keys</span>
 <span class=n>encoded_params</span> <span class=o>=</span> <span class=p>{}</span>
 <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>params</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
   <span class=n>encoded_k</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_plus</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>k</span><span class=p>))</span>
   <span class=n>encoded_v</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_plus</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>v</span><span class=p>))</span>
   <span class=n>encoded_params</span><span class=p>[</span><span class=n>encoded_k</span><span class=p>]</span> <span class=o>=</span> <span class=n>encoded_v</span>

 <span class=c># sort the parameters alphabetically by key</span>
 <span class=n>sorted_keys</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>encoded_params</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>

 <span class=c># create a string from the parameters</span>
 <span class=n>signing_string</span> <span class=o>=</span> <span class=s>""</span>

 <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
 <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>sorted_keys</span><span class=p>:</span>
   <span class=n>signing_string</span> <span class=o>+=</span> <span class=n>key</span>
   <span class=n>signing_string</span> <span class=o>+=</span> <span class=s>"="</span>
   <span class=n>signing_string</span> <span class=o>+=</span> <span class=n>encoded_params</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
   <span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
   <span class=k>if</span> <span class=n>count</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>sorted_keys</span><span class=p>):</span>
     <span class=n>signing_string</span> <span class=o>+=</span> <span class=s>"&amp;"</span>

 <span class=c># construct the base string</span>
 <span class=n>base_string</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
 <span class=n>base_string</span> <span class=o>+=</span> <span class=s>"&amp;"</span>
 <span class=n>base_string</span> <span class=o>+=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_plus</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
 <span class=n>base_string</span> <span class=o>+=</span> <span class=s>"&amp;"</span>
 <span class=n>base_string</span> <span class=o>+=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_plus</span><span class=p>(</span><span class=n>signing_string</span><span class=p>)</span>

 <span class=c># construct the key</span>
 <span class=n>signing_key</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_plus</span><span class=p>(</span><span class=n>client_secret</span><span class=p>)</span> <span class=o>+</span> <span class=s>"&amp;"</span> <span class=o>+</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_plus</span><span class=p>(</span><span class=n>access_secret</span><span class=p>)</span>

 <span class=c># encrypt the base string with the key, and base64 encode the result</span>
 <span class=n>hashed</span> <span class=o>=</span> <span class=n>hmac</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>signing_key</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=n>base_string</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=n>sha1</span><span class=p>)</span>
 <span class=n>signature</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>hashed</span><span class=o>.</span><span class=n>digest</span><span class=p>())</span>
 <span class=k>return</span> <span class=n>signature</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s>"utf-8"</span><span class=p>)</span></code></pre></figure><p>Finally, we can write a method to actually <em>make</em> the API request:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>query_get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>endpoint</span><span class=p>,</span> <span class=n>aspect</span><span class=p>,</span> <span class=n>get_params</span><span class=o>=</span><span class=p>{}):</span>

 <span class=c>#</span>
 <span class=c># rate limiting</span>
 <span class=bp>self</span><span class=o>.</span><span class=n>__rate_controller</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>__monitor</span><span class=p>)</span>

 <span class=c># ensure we're dealing with strings as parameters</span>
 <span class=n>str_param_data</span> <span class=o>=</span> <span class=p>{}</span>
 <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>get_params</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
   <span class=n>str_param_data</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>k</span><span class=p>)]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>

 <span class=c># construct the query url</span>
 <span class=n>url</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>api_base</span> <span class=o>+</span> <span class=s>"/"</span> <span class=o>+</span> <span class=n>endpoint</span> <span class=o>+</span> <span class=s>"/"</span> <span class=o>+</span> <span class=n>aspect</span> <span class=o>+</span> <span class=s>".json"</span>

 <span class=c># add the header parameters for authorisation</span>
 <span class=n>header_parameters</span> <span class=o>=</span> <span class=p>{</span>
   <span class=s>"oauth_consumer_key"</span><span class=p>:</span> <span class=n>client_id</span><span class=p>,</span>
   <span class=s>"oauth_nonce"</span><span class=p>:</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>(),</span>
   <span class=s>"oauth_signature_method"</span><span class=p>:</span> <span class=s>"HMAC-SHA1"</span><span class=p>,</span>
   <span class=s>"oauth_timestamp"</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span>
   <span class=s>"oauth_token"</span><span class=p>:</span> <span class=n>access_token</span><span class=p>,</span>
   <span class=s>"oauth_version"</span><span class=p>:</span> <span class=mf>1.0</span>
 <span class=p>}</span>

 <span class=c># collect all the parameters together for creating the signature</span>
 <span class=n>signing_parameters</span> <span class=o>=</span> <span class=p>{}</span>
 <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>header_parameters</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
   <span class=n>signing_parameters</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span>
 <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>str_param_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
   <span class=n>signing_parameters</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span>

 <span class=c># create the signature and add it to the header parameters</span>
 <span class=n>header_parameters</span><span class=p>[</span><span class=s>"oauth_signature"</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_signature</span><span class=p>(</span><span class=s>"GET"</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>signing_parameters</span><span class=p>)</span>

 <span class=c># add the OAuth headers</span>
 <span class=n>header_string</span> <span class=o>=</span> <span class=s>"OAuth "</span>
 <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
 <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>header_parameters</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
   <span class=n>header_string</span> <span class=o>+=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_plus</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>k</span><span class=p>))</span>
   <span class=n>header_string</span> <span class=o>+=</span> <span class=s>"=</span><span class=se>\"</span><span class=s>"</span>
   <span class=n>header_string</span> <span class=o>+=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_plus</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>v</span><span class=p>))</span>
   <span class=n>header_string</span> <span class=o>+=</span> <span class=s>"</span><span class=se>\"</span><span class=s>"</span>
   <span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
   <span class=k>if</span> <span class=n>count</span> <span class=o>&lt;</span> <span class=mi>7</span><span class=p>:</span>
     <span class=n>header_string</span> <span class=o>+=</span> <span class=s>", "</span>

 <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
   <span class=s>"Authorization"</span><span class=p>:</span> <span class=n>header_string</span>
 <span class=p>}</span>

 <span class=c># create the full url including parameters</span>
 <span class=n>url</span> <span class=o>=</span> <span class=n>url</span> <span class=o>+</span> <span class=s>"?"</span> <span class=o>+</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>urlencode</span><span class=p>(</span><span class=n>str_param_data</span><span class=p>)</span>
 <span class=n>request</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>

 <span class=c># make the API request</span>
 <span class=k>try</span><span class=p>:</span>
   <span class=n>response</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
   <span class=k>except</span> <span class=n>urllib</span><span class=o>.</span><span class=n>error</span><span class=o>.</span><span class=n>HTTPError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
   <span class=k>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
 <span class=k>raise</span> <span class=n>e</span>
   <span class=k>except</span> <span class=n>urllib</span><span class=o>.</span><span class=n>error</span><span class=o>.</span><span class=n>URLError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
   <span class=k>print</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
   <span class=k>raise</span> <span class=n>e</span>

 <span class=c># read the response and return the json</span>
 <span class=n>raw_data</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s>"utf-8"</span><span class=p>)</span>
 <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>raw_data</span><span class=p>)</span></code></pre></figure><p>Putting this all together, we have a simple Python class that acts as an API wrapper for GET requests to the Twitter REST API, including the signing and authentication of those requests. Using it is as simple as:</p><figure class=highlight><pre><code class=language-python data-lang=python> <span class=n>ta</span> <span class=o>=</span> <span class=n>Twitter_API</span><span class=p>()</span>

 <span class=c># retrieve tweets for a user</span>
 <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s>"screen_name"</span><span class=p>:</span> <span class=s>"martinjc"</span><span class=p>,</span>
 <span class=p>}</span>

 <span class=n>user_tweets</span> <span class=o>=</span> <span class=n>ta</span><span class=o>.</span><span class=n>query_get</span><span class=p>(</span><span class=s>"statuses"</span><span class=p>,</span> <span class=s>"user_timeline"</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span></code></pre></figure><p>As always, the full code is online on Github, in both my <a href=https://github.com/CompJCDF/Simple-Python-Twitter-API>personal account</a> and the <a href=https://github.com/CompJCDF>account for</a> the <a href=http://compj.cs.cf.ac.uk/ >MSc Computational Journalism</a>.</p></div></article></div></body></html>