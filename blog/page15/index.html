<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#b100b2><meta name=theme-color content=#b100b2><title>martinjc.com</title><meta name=description content="I am Dr Martin Chorley. I am a lecturer at the School of Computer Science & Informatics, Cardiff University.I'm programme leader for the MSc in Computational Journalism, and also senior personal tutor for all taught postgraduate students. I mainly do work that falls under the umbrella of the Mobile and Social Computing group.
"><link rel=icon href=/img/favicon.png><link href="https://fonts.googleapis.com/css?family=Roboto|Scope+One" rel=stylesheet><link rel=stylesheet type=text/css href=/css/main.css></head><body><header><div class=social><ul><li><a href=https://www.twitter.com/martinjc class="icon twitter" title=Twitter><svg viewBox="0 0 512 512"><path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"/></svg><!--[if lt IE 9]><em>Twitter</em><![endif]--></a></li><li><a href=mailto:ChorleyMJ@Cardiff.ac.uk class="icon email" title=Email><svg viewBox="0 0 512 512"><path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li><li><a href=https://www.facebook.com/martin.chorley class="icon facebook" title=Facebook><svg viewBox="0 0 512 512"><path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z"/></svg><!--[if lt IE 9]><em>Facebook</em><![endif]--></a></li><li><a href=https://www.github.com/martinjc class="icon github" title=GitHub><svg viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li><li><a href=https://www.instagram.com/martinjam class="icon instagram" title=Instagram><svg viewBox="0 0 512 512"><g><path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z"/><path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z"/><circle cx=351.5 cy=160.5 r=21.5 /></g></svg><!--[if lt IE 9]><em>Instagram</em><![endif]--></a></li><li><a href=https://www.last.fm/user/takitomouse class="icon lastfm" title=Last.fm><svg viewBox="0 0 512 512"><path d="M230.104 336.568l-13.607-36.988c0 0-22.11 24.66-55.268 24.66 -29.341 0-50.172-25.512-50.172-66.328 0-52.293 26.359-71.001 52.297-71.001 37.412 0 49.316 24.234 59.522 55.273l13.607 42.518c13.603 41.236 39.113 74.402 112.666 74.402 52.727 0 88.437-16.155 88.437-58.672 0-34.438-19.56-52.297-56.125-60.802l-27.209-5.951c-18.707-4.252-24.233-11.906-24.233-24.659 0-14.456 11.478-22.96 30.189-22.96 20.406 0 31.458 7.653 33.162 25.935l42.516-5.103c-3.402-38.263-29.761-53.996-73.127-53.996 -38.266 0-75.68 14.456-75.68 60.799 0 28.912 14.029 47.197 49.315 55.697l28.916 6.801c21.683 5.104 28.908 14.031 28.908 26.363 0 15.73-15.305 22.107-44.218 22.107 -42.941 0-60.794-22.534-70.999-53.574l-14.032-42.513c-17.854-55.271-46.342-75.68-102.892-75.68 -62.499-0.001-95.663 39.538-95.663 106.715 0 64.628 33.164 99.489 92.689 99.489C207.141 359.1 230.104 336.568 230.104 336.568L230.104 336.568z"/></svg><!--[if lt IE 9]><em>Last.fm</em><![endif]--></a></li><li><a href=https://uk.linkedin.com/in/martinchorley class="icon linkedin" title=LinkedIn><svg viewBox="0 0 512 512"><path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z"/></svg><!--[if lt IE 9]><em>LinkedIn</em><![endif]--></a></li></ul></div><nav><ul>|<li><a href=/ >&nbsp;home</a>&nbsp;|</li><li><a href=/blog>&nbsp;blog</a>&nbsp;|</li><li><a href=/research>&nbsp;research</a>&nbsp;|</li><li><a href=/publications>&nbsp;publications</a>&nbsp;|</li><li><a href=/teaching>&nbsp;teaching</a>&nbsp;|</li></ul></nav></header><div class=wrapper><article class=blogpost><header><h1><a href=/2011/09/08/django-foursquare-oauth-webapp.html>Django + Foursquare + OAuth = webapp?</a></h1><p class=author><span class=date>September 8, 2011</span> - by martin</p></header><div class=content><p>Moving on from my fun with getting django + twitter + oauth to play nicely, it’s now time to start writing a web app that uses foursquare as the authentication/login method. As part of this, I need a basic django framework for doing authentication with foursquare. This may be useful to someone else at some point (including me when I forget in three months time how I did things), so I’ve written up the details and added the code to <a href=https://github.com/martinjc/DjangoFoursq>github</a>.</p><p>Firstly, you need to <a href=https://foursquare.com/oauth/ >register an application</a> with Foursquare to get your Client ID and Client Secret. You can enter any name and website you want, but the callback url needs to be our local development machine (assuming that’s where you’re doing the development), and to be the callback url that we’re going to specify in a minute:</p><p><img src=http://martinchorley.co.uk/img/2011-09-08-django-foursquare-oauth-webapp/Foursquare-Register-300x174.jpg alt="Form to register an application"></p><p>The more observant will notice that the callback url is currently http://127.0.0.1/foursq_auth/callback/, but that the django web server actually runs on port 8000, so the url really needs to be http://127.0.0.1:8000/foursq_auth/callback/. Unfortunately the form validation doesn’t allow you to use a ‘:’ in your callback url. However, once the consumer is registered you can edit the callback url, and the form for that doesn’t validate the url (or does but doesn’t moan about the colon). Eventually, you are looking for the consumer to be registered with a callback url like this:</p><p><a href=http://martinchorley.co.uk/img/2011-09-08-django-foursquare-oauth-webapp/CapturFiles.jpg><img src=http://martinchorley.co.uk/img/2011-09-08-django-foursquare-oauth-webapp/CapturFiles-300x51.jpg alt=""></a></p><p>Once that is registered, we can get on with writing the code. The basic premise is pretty simple, we need just five urls in our django app, five views to go with them, and two basic html pages, one for login, and one to show we are logged in. Assuming you have a django project started (for reference the one I’m using here is called ‘Dj4sq’) we can start by creating our foursquare app:</p><div class=highlighter-rouge><pre class=highlight><code>django-admin.py startapp foursq_auth
</code></pre></div><p>We then want to edit urls.py for our main django project to allow the new app to handle its own views:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=n>urlpatterns</span> <span class=o>=</span> <span class=n>patterns</span><span class=p>(</span><span class=s>''</span><span class=p>,</span>
    <span class=p>(</span><span class=s>r'^foursq_auth/'</span><span class=p>,</span> <span class=n>include</span><span class=p>(</span><span class=s>'Dj4sq.foursq_auth.urls'</span><span class=p>)),</span>
<span class=p>)</span></code></pre></figure><p>and create and edit a file urls.py in the foursq_auth app with the five views we want:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=n>urlpatterns</span> <span class=o>=</span> <span class=n>patterns</span><span class=p>(</span><span class=s>'foursq_auth.views'</span><span class=p>,</span>
    <span class=c># main page redirects to start or login</span>
    <span class=n>url</span><span class=p>(</span><span class=s>r'^$'</span><span class=p>,</span> <span class=n>view</span><span class=o>=</span><span class=n>main</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s>'main'</span><span class=p>),</span>
    <span class=c># receive OAuth token from 4sq</span>
    <span class=n>url</span><span class=p>(</span><span class=s>r'^callback/$'</span><span class=p>,</span> <span class=n>view</span><span class=o>=</span><span class=n>callback</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s>'oauth_return'</span><span class=p>),</span>
    <span class=c># logout from the app</span>
    <span class=n>url</span><span class=p>(</span><span class=s>r'^logout/$'</span><span class=p>,</span> <span class=n>view</span><span class=o>=</span><span class=n>unauth</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s>'oauth_unauth'</span><span class=p>),</span>
    <span class=c># authenticate with 4sq using OAuth</span>
    <span class=n>url</span><span class=p>(</span><span class=s>r'^auth/$'</span><span class=p>,</span> <span class=n>view</span><span class=o>=</span><span class=n>auth</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s>'oauth_auth'</span><span class=p>),</span>
    <span class=c># main page once logged in</span>
    <span class=n>url</span><span class=p>(</span> <span class=s>r'^done/$'</span><span class=p>,</span> <span class=n>view</span><span class=o>=</span><span class=n>done</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s>'oauth_done'</span> <span class=p>),</span>
<span class=p>)</span></code></pre></figure><p>We then need our two basic html pages login.html and done.html:</p><figure class=highlight><pre><code class=language-html data-lang=html><span class=nt>&lt;html&gt;</span>
    <span class=nt>&lt;head&gt;</span>
        <span class=nt>&lt;title&gt;</span>Foursquare OAuth Example<span class=nt>&lt;/title&gt;</span>
    <span class=nt>&lt;/head&gt;</span>
    <span class=nt>&lt;body&gt;</span>
    <span class=nt>&lt;div</span> <span class=na>id=</span><span class=s>"login"</span><span class=nt>&gt;</span>
        <span class=nt>&lt;p&gt;</span>Sign in with Foursquare to begin.<span class=nt>&lt;/p&gt;</span>
        <span class=nt>&lt;p&gt;&lt;a</span> <span class=na>href=</span><span class=s>"auth/"</span><span class=nt>&gt;</span>Login<span class=nt>&lt;/a&gt;&lt;/p&gt;</span>
    <span class=nt>&lt;/div&gt;</span>
    <span class=nt>&lt;/body&gt;</span>
<span class=nt>&lt;/html&gt;</span>
<span class=nt>&lt;html&gt;</span>
    <span class=nt>&lt;head&gt;</span>
        <span class=nt>&lt;title&gt;</span>Foursquare OAuth Example<span class=nt>&lt;/title&gt;</span>
    <span class=nt>&lt;/head&gt;</span>
    <span class=nt>&lt;body&gt;</span>
        <span class=nt>&lt;p&gt;</span>Hi , you've successfully logged in! <span class=nt>&lt;/p&gt;</span>
	<span class=nt>&lt;a</span> <span class=na>href=</span><span class=s>"../logout/"</span><span class=nt>&gt;</span>Logout<span class=nt>&lt;/a&gt;</span>
    <span class=nt>&lt;/body&gt;</span>
<span class=nt>&lt;/html&gt;</span></code></pre></figure><p>All that’s left after that is to write the views to tie it all together. We need a few variables defined for our code to work:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=n>CLIENT_ID</span> <span class=o>=</span> <span class=s>'YOUR_CLIENT_ID'</span>
<span class=n>CLIENT_SECRET</span> <span class=o>=</span> <span class=s>'YOUR_CLIENT_SECRET'</span>

<span class=n>request_token_url</span> <span class=o>=</span> <span class=s>'https://foursquare.com/oauth2/authenticate'</span>
<span class=n>access_token_url</span> <span class=o>=</span> <span class=s>'https://foursquare.com/oauth2/access_token'</span>
<span class=n>redirect_url</span> <span class=o>=</span> <span class=s>'http://127.0.0.1:8000/foursq_auth/callback'</span></code></pre></figure><p>We can then write the views. The first one, ‘main’ is super easy, as it only needs to return our login page:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>main</span><span class=p>(</span> <span class=n>request</span> <span class=p>):</span>
    <span class=k>return</span> <span class=n>render_to_response</span><span class=p>(</span> <span class=s>'foursq_auth/login.html'</span> <span class=p>)</span></code></pre></figure><p>The second, ‘auth’, is the first step in our authentication process, requesting an authorisation code from foursquare and redirecting the user to the page to authorise our app:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>auth</span><span class=p>(</span> <span class=n>request</span> <span class=p>):</span>
    <span class=c># build the url to request</span>
    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span><span class=s>'client_id'</span> <span class=p>:</span> <span class=n>CLIENT_ID</span><span class=p>,</span>
            <span class=s>'response_type'</span> <span class=p>:</span> <span class=s>'code'</span><span class=p>,</span>
            <span class=s>'redirect_uri'</span> <span class=p>:</span> <span class=n>redirect_url</span> <span class=p>}</span>
    <span class=n>data</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>urlencode</span><span class=p>(</span> <span class=n>params</span> <span class=p>)</span>
    <span class=c># redirect the user to the url to confirm access for the app</span>
    <span class=k>return</span> <span class=n>HttpResponseRedirect</span><span class=p>(</span><span class=s>'</span><span class=si>%</span><span class=s>s?</span><span class=si>%</span><span class=s>s'</span> <span class=o>%</span> <span class=p>(</span><span class=n>request_token_url</span><span class=p>,</span> <span class=n>data</span><span class=p>))</span></code></pre></figure><p>If the user accepts our app, they’ll be re-directed to our callback url, and an authorisation code will be passed back as one of the parameters of the url, so the next view, ‘callback’ needs to deal with this. It then needs to post a request to foursquare with the authorisation code in order to receive the access_token for the user:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=c># get the code returned from foursquare</span>
<span class=n>code</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>GET</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s>'code'</span><span class=p>)</span>

<span class=c># build the url to request the access_token</span>
<span class=n>params</span> <span class=o>=</span> <span class=p>{</span> <span class=s>'client_id'</span> <span class=p>:</span> <span class=n>CLIENT_ID</span><span class=p>,</span>
           <span class=s>'client_secret'</span> <span class=p>:</span> <span class=n>CLIENT_SECRET</span><span class=p>,</span>
           <span class=s>'grant_type'</span> <span class=p>:</span> <span class=s>'authorization_code'</span><span class=p>,</span>
           <span class=s>'redirect_uri'</span> <span class=p>:</span> <span class=n>redirect_url</span><span class=p>,</span>
           <span class=s>'code'</span> <span class=p>:</span> <span class=n>code</span><span class=p>}</span>
<span class=n>data</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>urlencode</span><span class=p>(</span> <span class=n>params</span> <span class=p>)</span>
<span class=n>req</span> <span class=o>=</span> <span class=n>urllib2</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span> <span class=n>access_token_url</span><span class=p>,</span> <span class=n>data</span> <span class=p>)</span>

<span class=c># request the access_token</span>
<span class=n>response</span> <span class=o>=</span> <span class=n>urllib2</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span> <span class=n>req</span> <span class=p>)</span>
<span class=n>access_token</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span> <span class=n>response</span><span class=o>.</span><span class=n>read</span><span class=p>(</span> <span class=p>)</span> <span class=p>)</span>
<span class=n>access_token</span> <span class=o>=</span> <span class=n>access_token</span><span class=p>[</span><span class=s>'access_token'</span><span class=p>]</span>

<span class=c># store the access_token for later use</span>
<span class=n>request</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s>'access_token'</span><span class=p>]</span> <span class=o>=</span> <span class=n>access_token</span>

<span class=c># redirect the user to show we're done</span>
<span class=k>return</span> <span class=n>HttpResponseRedirect</span><span class=p>(</span><span class=n>reverse</span><span class=p>(</span> <span class=s>'oauth_done'</span> <span class=p>)</span> <span class=p>)</span></code></pre></figure><p>If we’ve got the access token, we’re all set. From now on we can make any calls to the Foursquare API that require authorisation, as long as we supply this token as a parameter to the request named ‘oauth_token’. To prove that we’re logged in, we’ll re-direct the user at the end of the callback to a ‘done’ page, which will display some user details:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>done</span><span class=p>(</span> <span class=n>request</span> <span class=p>):</span>
    <span class=c># get the access_token</span>
    <span class=n>access_token</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s>'access_token'</span><span class=p>)</span>

    <span class=c># request user details from foursquare</span>
    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span> <span class=s>'oauth_token'</span> <span class=p>:</span> <span class=n>access_token</span> <span class=p>}</span>
    <span class=n>data</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>urlencode</span><span class=p>(</span> <span class=n>params</span> <span class=p>)</span>
    <span class=n>url</span> <span class=o>=</span> <span class=s>'https://api.foursquare.com/v2/users/self'</span>
    <span class=n>full_url</span> <span class=o>=</span> <span class=n>url</span> <span class=o>+</span> <span class=s>'?'</span> <span class=o>+</span> <span class=n>data</span>
    <span class=k>print</span> <span class=n>full_url</span>
    <span class=n>response</span> <span class=o>=</span> <span class=n>urllib2</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span> <span class=n>full_url</span> <span class=p>)</span>
    <span class=n>response</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>read</span><span class=p>(</span> <span class=p>)</span>
    <span class=n>user</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span> <span class=n>response</span> <span class=p>)[</span><span class=s>'response'</span><span class=p>][</span><span class=s>'user'</span><span class=p>]</span>
    <span class=n>name</span> <span class=o>=</span> <span class=n>user</span><span class=p>[</span><span class=s>'firstName'</span><span class=p>]</span>

    <span class=c># show the page with the user's name to show they've logged in</span>
    <span class=k>return</span> <span class=n>render_to_response</span><span class=p>(</span><span class=s>'foursq_auth/done.html'</span><span class=p>,</span> <span class=p>{</span><span class=s>'name'</span><span class=p>:</span><span class=n>name</span><span class=p>})</span></code></pre></figure><p>And with that, we’re all done. We can fire up the django server with:</p><div class=highlighter-rouge><pre class=highlight><code>python manage.py runserver
</code></pre></div><p>open our browser to 127.0.0.1:8000/foursq_auth/ and go through the login process:</p><p><img src=http://martinchorley.co.uk/img/2011-09-08-django-foursquare-oauth-webapp/login-html-300x189.jpg alt="Login Page"></p><p><img src=http://martinchorley.co.uk/img/2011-09-08-django-foursquare-oauth-webapp/foursquare-approval1-300x185.jpg alt="Approving the app at Foursquare"></p><p><img src=http://martinchorley.co.uk/img/2011-09-08-django-foursquare-oauth-webapp/done-html-300x189.jpg alt="Successfully logged in"></p><p>And that’s that - A Django web app doing OAuth authentication with Foursquare. The full code is up on <a href=https://github.com/martinjc/DjangoFoursq>github</a> if you want to take a closer look.</p></div></article><hr><article class=blogpost><header><h1><a href=/2011/09/08/edinburgh-festival-day-five.html>Edinburgh Festival... Day Five</a></h1><p class=author><span class=date>September 8, 2011</span> - by martin</p></header><div class=content><p>It’s the last full day at the festival and we wake up even later than the day before. It’s so late we decide to skip breakfast, and as it’s time for lunch we’ll head out for curry. A quick curry and rice and we’re up and running for the day once more. The shows today don’t start until later on, so we have a bit of a walk around, grab a coffee and cake, then once more split, as Lisa decides to go back to the flat briefly while I head to pub. I sit out of the rain doing the crossword, have a pint and await Lisa’s return. She arrives, we finish the crossword, and head off to the show. The first show of the day is Ruby Wax in her one woman play (that’s got two women in it): <strong>Losing It</strong>. It’s a fantastic and honest play about mental illness, really well done, with some laughs and a lot of truth.</p><p>Following the show we take a walk over to near Arthur’s seat, then back towards town for the last show of our festival. On the way we find a really ace pub that I think will be my local when I make it to Edinburgh full time. We have a quick pint, then go to the Queens Hall for <strong>Henry Rollins</strong>. The man is amazing, he gets up on stage and just talks for the evening, and everything he says is amusing or thoughtful and brilliant. He’s basically just telling us what he’s done for the last year, with some old road stories thrown in for good measure, but he’s such a great speaker its one of the highlights of the week. I think most academics I’ve seen talk could learn hugely from the passion and thought he puts into telling stories.</p><p>Post show we head back to the pub for a couple of pints, then grab a chinese takeaway and head back to the flat. With that, we’re done. Wasted, destroyed. Great week.</p><p>Shows: 2 Pints: A few Chinese Food: some Aging rock stars: one</p></div></article><hr><article class=blogpost><header><h1><a href=/2011/09/08/edinburgh2011day4.html>Edinburgh Festival... Day Four</a></h1><p class=author><span class=date>September 8, 2011</span> - by martin</p></header><div class=content><p>Wednesday we wake up later than intended, so miss the planned start to the day at the Shakespeare breakfast. In all, it’s a very slow start to the day, the pace of the previous few days is beginning to get to us. We head off for a walk and a bagel to wake up, and I get butter all over my face from a very lovely, but very buttery and bacon filled bagel. After soaking up a bit of sunshine in the cafe we head down to town for our first show, an adaptation of <strong>Secret Window, Secret Garden</strong>. The venue is at C soco, which is the massive hole in the ground in the Old Town where the <a href=http://en.wikipedia.org/wiki/Edinburgh_Cowgate_fire,_2002>fire</a> was a few years back, the one that took out the original Gilded Balloon and the School of Informatics’ AI department. The venue itself is in one of the buildings left standing on the site, which may well have been part of the University from looking at it, and the specific venue we’re in is right at the top. I estimate we climbed about 4000ft to reach it, but I may be wrong.</p><p>The play itself is nicely done, they’ve cut the story down to the minimum of necessary elements to cover everything in the plot while still bringing the play in at an hour, and the acting is pretty solid, if not stellar. The lead character is by far the best actor of the lot, doing a very good job at playing the role of the author losing his mind. They stick to the plot of the book too, rather than the film, which is pleasing. The guy playing John Shooter troubles me a little, and it’s not until afterwards that I realise it’s because he looks, sounds, and acts very much like someone at COMSC.</p><p>We’ve got a gap in the afternoon, so we head down to one of the ‘attractions’ of Edinburgh we haven’t visited yet, the Botanic Gardens. It’s a fair enough walk, mostly downhill. We cause a problem in the cafe at the east gate by attempting to buy things with a twenty pound note, the horror. They have nowhere near enough change, but there’s a solution to the problem if they let me off the odd 35p and I just pay them £5. They agree, so I effectively steal 35p of goods off a registered charity. In your face, plants.</p><p>It’s a nice place for a wander round, as lovely gardens tend to be. We decide to put up the cash to go into the hothouses, being as we’ve walked all the way down there. Surprisingly, they’re hot, and full of plants. I can’t get the Jurassic Park theme out of my head as I walk around, the whole place is reminiscent of the science labs in the sequels that have been taken over by plants, there’s a nice bit of ageing decay to them. Very few dinosaurs though, luckily.</p><p>After the botanic gardens we head to a pub down the road for a pretty decent dinner and a couple of pints, then make long trek back up the hill and into town. Lisa wants to head back to the flat, but I can’t be bothered, so I head down to the Brewdog bar on Cowgate to wait for her. I’m quite a fan of Brewdog beer, and it’s a nice bar (if a bit small), serving some very lovely booze. While I’m stood at the bar reading the paper it begins to absolutely piss it down with rain, so by the time Lisa gets back into town she is soaked through once more. As ever, the theory ‘go to the pub, not home’ has paid off.</p><p>We head up to the Assembly Hall to meet Lisa’s colleague and his wife for a pint before <strong>Sarah Millican</strong>. We have a nice chat for half an hour, then get into the longest queue yet for a show. We end up with seats up on the balcony, but it’s a fine venue that seems to hold a lot of people without feeling massive, so the view is pretty good and you still feel pretty close to the stage. Sarah Millican is good, but the show seems like a collection of one liners and jokes rather than a coherent whole. Despite that it’s hilariously funny, and a good time is had by both of us. I steal two badges at the end of the show, making it both a registered charity and a comedian that I’ve effectively cheated in one day.</p><p>Following the show we head down to the Conference Centre for an Amnesty gig. I thought the queue for the Millican show was big, but the queue at the EICC was huge, snaking all the way round to the back of the building and out into the street. I have a minor altercation with some old ladies in the queue who are queue jumping, and refuse to move when I inform them of the fact. Another chap also tries to let them know, but they ignore him too. So we talk loudly about the older generation just thinking they can do what they want, and how old people have no manners anymore and don’t understand about how being British means we treat each other decently and are polite and so on. I’m half convinced we quite embarrassed the one old lady, but her friend was made of sterner stuff. The old ladies have annoyed me massively, but it’s wearing off by the time we get into the venue, until I discover that bottles of beer at the bar are £3.80 each, which almost makes things even worse. Luckily the show is laugh balls funny. It’s basically ten minutes sets from a whole mix of comedians that we wouldn’t have otherwise seen, with a large number of laughs coming from making the signers at the side of the stage make inappropriate gestures. It’s a great gig, with performances from Mark Watson, Ed Byrne, Russell Kane, Jenny Eclair, David O’Doherty, Holly Walsh and Roisin Conaty. Once more we both enjoy it, laugh too much, and leave happy. We head home satisfied for the evening.</p><p>Shows: 3 Pints: God knows Queues: Massive Old ladies: Three (irritating and rude)</p></div></article><hr><article class=blogpost><header><h1><a href=/2011/09/07/edinburgh2011day3.html>Edinburgh Festival... Day Three</a></h1><p class=author><span class=date>September 7, 2011</span> - by martin</p></header><div class=content><p>Success today as we start the day with a run round the meadows, despite all the beer yesterday. A ‘debate’ which I lose ends in us also running around the links and up towards Warrender Park Crescent. The flat I stayed in during my second stint in Edinburgh for the MSc was there, so it was nice to be running around the old stomping ground.</p><p>After the run I bump into another Shrewsbury Town fan outside tesco’s. I knew there were more than one of us. We buy picnic material from the shop, then despite the weather forecast promising rain we decide to head up Arthur’s seat. What a stupid idea. The whole time we are out of the flat it absolutely chucks it down. A bit of rain isn’t enough to stop us though, we go up the hill anyway, stand under a tree and eat our cheese sandwiches, then go home. A proper british picnic.</p><p>We manage to dry off in the flat, grab a cup of tea, then head over to The Stand comedy club for the afternoons shows. The Stand is a tiny venue, but was very full for both shows this afternoon, so there was a great atmosphere in the place. First up was Simon Munnery, with his show “<strong>Hats off for the 101ers (and other material)</strong>”, a show that started with a punk rock musical about the designers of the 101 airship, which tells you a fair amount about the type of show it was. Simon is a comedian I’ve heard a lot about but never seen, he was ace, really really funny, with some really weird material, but all of it brilliant. Quite odd, but brilliant.  Following Simon was Stewart Lee with his show “<strong>Flickwerk</strong>”. I love Stewart Lee with a passion bordering on obsessive, he’s absolutely brilliant. The show (that wasn’t really a show, just work in progress) had me in stitches all the way through. I was genuinely concerned that I may have a heart attack at points during the show. Afterwards I hung around to buy a CD off Stewart and tell him I thought it was really good. Which it was. Unfortunately I’d forgotten to tell Lisa I was going to do that, so she headed straight outside and stood in the rain waiting for me. Oops.</p><p>We headed off for an Italian, blowing the budget at quite a nice posh restaurant on a lot of food and red wine. I decided during my meal that my comedy nerves had been destroyed totally by the show and I would never laugh at anything ever again. Luckily I realised later that it wasn’t true.</p><p>The last show of the evening was at the Edinburgh College of Art: “<strong>Tales from Edgar Allan Poe</strong>”. Another amateur production, this was exceedingly odd. The audience all stood around the edge of the room while various Poe poems and stories were acted out by a cast who, when not involved in a tale, stood around in creepy masks. The performances were all really good, and we left at almost midnight feeling pretty damn creeped out.</p><p>Shows: 3 Pints: 4 Wine: loads Comedy: TOO GOOD.</p></div></article><hr><article class=blogpost><header><h1><a href=/2011/09/05/edinburgh2011day2.html>Edinburgh Festival... Day Two</a></h1><p class=author><span class=date>September 5, 2011</span> - by martin</p></header><div class=content><p>Day two began with the best intentions - I woke up early, fully intending to go for a run around the meadows. It only took about thirty seconds of being awake for me to realise that wasn’t going to happen, so I went back to sleep for another hour. By about 8.30 the waking up was really beginning to take hold, so we relented and got up.</p><p>Usual morning operations completed (including Lisa having to conclude delicate negotiations with reception for the use of a hairdryer), we headed out into town. The first show of the day was up at C-too, at St Columbus by the Castle, so we had our first experience of trying to get anywhere near the Royal Mile at festival time. It appears that at festival time the Royal Mile essentially becomes a solid mass of people. Some of them want you to come to their show. Some of them want you to go to someone else’s show. Many of them want to give you a leaflet. Some of them just want to perform a show for you in the street. I hate crowds. I hate people walking slowly. It was not a happy start to the day.</p><p>Luckily we got to the venue in time to have a sit down in the church garden outside the venue and have a coffee. The weather again was glorious, so we were able to sit in the early morning sun and soak up the warmth and admire the views over south Edinburgh. Again, writing this now, I think I probably should have taken some photos, but I didn’t. Just go there and see it yourself, it’s much better.</p><p>The show we were going to see was “<strong>Love’s Labour’s Lost</strong>”. To be honest, once we got into the venue I was a bit worried as it seemed to be being performed by young people. I have strong views about ‘young people’, and those views seem to be getting worse as I get older. Luckily though, these young people were of the talented variety, and put on a pretty good show. I’d never seen or read the play before, so can’t compare it to the source, but the production was well done and well acted, and they’d gone down the current trendy route of inserting modern songs and cultural references into a shakespeare play, but carried it off well. It was again a thoroughly enjoyable hour, and it’s always nice to kick the day off with a bit of culture.</p><p>Following the show we wandered around the old town for a bit in search of a postbox, then sought out lunch. We then headed down to the BBC pop-up venue on Potterrow, where our next show was. This was actually what I was calling ‘Richard Herring Day’, as we had two shows from the man himself in one day. First up was a ‘festival special’ recording of his Radio 4 show ‘<strong>Richard Herring’s Objective</strong>’. I liked the BBC venue because they seemed not to believe in queues, instead giving you a numbered sticker on arrival then calling you in to the venue by number when it was time for the show. This means the people that get there first still get the best seats, but also get to wander around, go get drinks, look at other things etc, rather than standing around in a queue. Unfortunately as we’d decided to call at the Pear Tree for a swift pint before the show we were somewhere at the back of the virtual queue. We still got in though (free BBC shows are over-sold to make sure there’s a full audience to make it sound good on the radio) and were entertained by Mr Herring and his guests: Emma Kennedy and Susan Calman. The show was funny, but it dragged in parts - and to be honest the unscripted moments were probably the funniest moments, particularly the parts that went wrong and had to be re-recorded. The casual racism against the Scots was highly amusing and brave given that it was performed in the middle of Edinburgh.</p><p>We had a couple of hours free then before the next show, so did a bit more walking around the city, called for a couple of drinks, got some dinner, then headed down to Bristo Square. As we stood in the queue outside the venue drinking some weird festival ale we got chatting to the man in the queue next to us, who was an American. A real live foreigner and everything. Strangely enough, he was only in Edinburgh for a couple of days and was heading to Cardiff afterwards to go sightseeing - apparently the appeal of Doctor Who and Torchwood is greater than we’d imagined, as he was quite a fan and was visiting solely because of those shows. We gave him a bit of travel advice, hopefully he survived the visit.</p><p>The show we were queuing for was Richard Herring again, this time for his main show “<strong>What is Love Anyway?</strong>”. It’s getting a bit boring to say, but this was yet another brilliant hour of comedy. Very honest and at times emotional comedy, but full of laughs and well worth a watch. Unsurprisingly the subject of the show was love, and how us humans use and abuse it, how we deal with it, and an attempt to discover what it really is. Loved the show.</p><p>After the show we headed over to Pleasance Courtyard to meet up with one of Lisa’s colleagues who was also up in Edinburgh. We had a couple of drinks, swapped some show reviews and tips and had a bit of a chat. The place was swarming in comedians, some well known faces being left (relatively) alone, some less well known trying to convince people to come see their shows. After a while we all headed back towards the flats (they were staying in the same place), but me and Lisa decided there was time for another drink, so headed off to the pub.</p><p>Shows: 3 Pints: 8 Meals: too many noodles Herring: twice</p></div></article><hr><div class=pagination><a href=/blog/page14 class=previous>Previous</a> <span class=page_number>Page: 15 of 20</span> <a href=/blog/page16 class=next>Next</a></div></div></body></html>