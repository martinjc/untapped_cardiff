!function(){function t(t){L.mapbox.accessToken="pk.eyJ1IjoibWFydGluamMiLCJhIjoiREhUQWk4cyJ9.g91QWy-CEqvercw_UHNm1A";var e=L.tileLayer("https://{s}.tiles.mapbox.com/v4/martinjc.n04cmol3/{z}/{x}/{y}.png?access_token="+L.mapbox.accessToken,{attribution:'<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'}),n=L.map(t,{layers:e,center:[51.479677,-3.179254],zoom:16}),a=[],o=d3.select(t).append("div").attr("class","tooltip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background-color","rgba(255,255,255,0.8)").text("a simple tooltip"),i=!1,l=d3.scale.quantile().range(colorbrewer.Reds[7]),s=function(t){var e=0;t.forEach(function(t){t.count>e&&(e=+t.count),a.push({lat:t.location.lat,lon:t.location.lng,count:+t.count,name:t.venue_name})}),l.domain([0,e])},r=function(){d3.select("#overlay").remove();var t=n.getBounds(),e=n.latLngToLayerPoint(t.getNorthWest()),s=d3.set(),r=t.pad(.4),c=a.filter(function(t){var e=new L.LatLng(t.lat,t.lon);if(!r.contains(e))return!1;var a=n.latLngToLayerPoint(e),o=a.toString();return s.has(o)?!1:(s.add(o),t.x=a.x,t.y=a.y,!0)}),p=function(t){var e="";return e+=t.name+"<br>"},y=d3.select(n.getPanes().overlayPane).append("svg").attr("id","overlay").attr("class","leaflet-zoom-hide").style("width",n.getSize().x+"px").style("height",n.getSize().y+"px").style("margin-left",e.x+"px").style("margin-top",e.y+"px"),d=y.append("g").attr("transform","translate("+-e.x+","+-e.y+")"),u=d.attr("class","points").selectAll("g").data(c).enter().append("g").attr("class","point");u.append("circle").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).style("fill",function(t){return l(+t.count)}).style("stroke","#000").style("stroke-width","0.5px").attr("r",8).on("mouseover",function(t){p&&(o.html(p(t)),i=!0,o.style("visibility","visible"))}).on("mousemove",function(){p&&o.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px")}).on("mouseout",function(){p&&(i=!1,o.style("visibility","hidden"))}).on("click",function(t){p&&(i?(o.style("visibility","hidden"),i=!1):(o.html(p(t)),o.style("visibility","visible"),o.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px"),i=!0))})};n.on("viewreset moveend",r),this.add_data=s,this.draw=r}this.MapChart=t}();