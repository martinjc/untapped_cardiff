!function(){function t(t){this.width=void 0,this.height=void 0,this.element_selector=t,this.checkin_data={},this.day=d3.time.format("%w"),this.week=d3.time.format("%U"),this.percent=d3.format(".1%"),this.format=d3.time.format("%Y-%m-%d"),this.colour_scale=d3.scale.quantile().range(colorbrewer.Reds[9]),this.svg=d3.select(t).selectAll("svg").data([2015]).enter().append("svg"),this.set_size(),this.cellSize=this.width/53}function e(t,e){this.transition_duration=1e3,this.element_selector=t,this.padding=e,this.colour_scale=d3.scale.quantile().range(colorbrewer.Reds[9]),this.svg=d3.select(this.element_selector).append("svg"),this.svg.append("g").attr("class","x axis"),this.svg.append("g").attr("class","y axis"),this.x_scale=d3.scale.ordinal(),this.y_scale=d3.scale.linear().nice(),this.x_axis=d3.svg.axis().scale(this.x_scale).orient("bottom"),this.y_axis=d3.svg.axis().scale(this.y_scale).orient("left").ticks(8),this.set_size()}t.prototype.set_size=function(){this.width=+d3.select(this.element_selector).node().getBoundingClientRect().width,this.height=+d3.select(this.element_selector).node().getBoundingClientRect().height,this.svg.attr("height",this.height).attr("width",this.width)},t.prototype.re_draw=function(t){var e=this;this.rect=this.svg.selectAll(".day").data(function(t){return d3.time.days(new Date(t,0,1),new Date(t+1,0,1))}).enter().append("rect").attr("class","day").attr("fill","none").attr("stroke","#ccc").attr("width",this.cellSize).attr("height",this.cellSize).attr("x",function(t){return e.week(t)*e.cellSize}).attr("y",function(t){return e.day(t)*e.cellSize}).datum(this.format);var i=this.svg.selectAll(".month").data(function(t){return d3.time.months(new Date(t,0,1),new Date(t+1,0,1))}).enter().append("g").attr("class","month"),a=function(t){var i=new Date(t.getFullYear(),t.getMonth()+1,0),a=+e.day(t),s=+e.week(t),n=+e.day(i),r=+e.week(i);return"M"+(s+1)*e.cellSize+","+a*e.cellSize+"H"+s*e.cellSize+"V"+7*e.cellSize+"H"+r*e.cellSize+"V"+(n+1)*e.cellSize+"H"+(r+1)*e.cellSize+"V0H"+(s+1)*e.cellSize+"Z"};i.append("path").attr("d",a),i.append("text").text(function(t){return e.get_month(t.getMonth())}).attr("x",function(t){var i=+e.week(t);return(i+1)*e.cellSize}).attr("y",8*e.cellSize);for(var s in t){var n=new Date(t[s].time);n=n.toDateString(),this.checkin_data[n]=n in this.checkin_data?this.checkin_data[n]+1:1}var r=0;for(var h in this.checkin_data)this.checkin_data[h]>r&&(r=this.checkin_data[h]);this.colour_scale.domain([1,r]),this.rect.filter(function(t){return new Date(t).toDateString()in e.checkin_data}).attr("fill",function(t){return e.colour_scale(e.checkin_data[new Date(t).toDateString()])})},t.prototype.get_month=function(t){return 0===t?"Jan":1===t?"Feb":2===t?"Mar":3===t?"Apr":4===t?"May":5===t?"Jun":6===t?"Jul":7===t?"Aug":8===t?"Sep":9===t?"Oct":10===t?"Nov":11===t?"Dec":void 0},e.prototype.set_size=function(){this.width=+d3.select(this.element_selector).node().getBoundingClientRect().width,this.height=+d3.select(this.element_selector).node().getBoundingClientRect().height,this.x_scale.rangeRoundBands([this.padding.left,this.width-this.padding.right],.1),this.y_scale.range([this.height-this.padding.bottom,this.padding.top]),this.svg.attr("height",this.height).attr("width",this.width),d3.select(".x.axis").attr("transform","translate(0,"+(this.height-this.padding.bottom)+")"),d3.select(".y.axis").attr("transform","translate("+this.padding.left+",0)"),this.num_bars=this.width<=500?5:this.width>500&&this.width<=600?10:this.width>600&&this.width<=1e3?15:20},e.prototype.re_draw=function(t,e,i,a,s){this.set_size();var n=this;this.data=t,this.x=e,this.y=i,s&&(this.data.sort(function(t,e){return t[n.y]>e[n.y]?-1:t[n.y]<e[n.y]?1:0}),n.data=n.data.slice(0,this.num_bars)),this.x_labels=this.data.map(function(t){return t[e]});var r=d3.max(this.data,function(t){return t[n.y]});this.x_scale.domain(this.x_labels),this.y_scale.domain([0,r]),this.colour_scale.domain([0,r]),this.y_label=a;var h=this.svg.selectAll(".bar").data(n.data);h.enter().append("rect").attr("x",function(t){return n.x_scale(t[n.x])}).attr("y",n.height-n.padding.bottom).attr("width",n.x_scale.rangeBand()).attr("height",0).attr("fill",function(t){return n.colour_scale(t[n.y])}).attr("class","bar"),h.transition().duration(n.transition_duration).attr("y",function(t){return n.y_scale(t[n.y])}).attr("height",function(t){return n.height-n.padding.bottom-n.y_scale(t[n.y])}),h.exit().transition().duration(this.transition_duration).attr("y",n.height).attr("height",0).remove(),this.svg.select(".x.axis").attr("transform","translate(0,"+(this.height-this.padding.bottom)+")").transition().duration(this.transition_duration).call(this.x_axis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-35)"),this.svg.select(".y.axis").attr("transform","translate("+this.padding.left+",0)").transition().duration(this.transition_duration).call(this.y_axis),this.svg.select(".y.axis").append("text").attr("class","y label").attr("text-anchor","end").attr("dx","-6em").attr("dy","-3em").attr("transform","rotate(-90)").text(this.y_label)},this.BarChart=e,this.DayChart=t}();