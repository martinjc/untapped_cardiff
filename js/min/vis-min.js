!function(){function t(t,i){this.transition_duration=1e3,this.element_selector=t,this.padding=i,this.colour_scale=d3.scale.quantile().range(colorbrewer.Reds[7]),this.svg=d3.select(this.element_selector).append("svg"),this.svg.append("g").attr("class","x axis"),this.svg.append("g").attr("class","y axis"),this.x_scale=d3.time.scale.utc(),this.y_scale=d3.scale.linear().nice(),this.x_axis=d3.svg.axis().scale(this.x_scale).orient("bottom").ticks(d3.time.minute,30).tickFormat(d3.time.format("%I:%M%p")),this.y_axis=d3.svg.axis().scale(this.y_scale).orient("left").ticks(8),this.set_size(),this.data=void 0,this.display_data=void 0}function i(t){this.width=void 0,this.height=void 0,this.element_selector=t,this.checkin_data={},this.day=d3.time.format("%w"),this.week=d3.time.format("%U"),this.percent=d3.format(".1%"),this.format=d3.time.format("%Y-%m-%d"),this.colour_scale=d3.scale.quantile().range(colorbrewer.Reds[7]),this.svg=d3.select(t).selectAll("svg").data([2015]).enter().append("svg"),this.set_size(),this.cellSize=this.width/53}function e(t,i){this.transition_duration=1e3,this.element_selector=t,this.padding=i,this.colour_scale=d3.scale.quantile().range(colorbrewer.Reds[7]),this.svg=d3.select(this.element_selector).append("svg"),this.svg.append("g").attr("class","x axis"),this.svg.append("g").attr("class","y axis");var e=d3.time.scale().nice(),a=d3.scale.linear().nice();this.line=d3.svg.line().x(function(t){return e(new Date(t.date))}).y(function(t){return a(t.count)}).interpolate("step-after"),this.x_scale=e,this.y_scale=a;var s=d3.time.format("%a %b %d %I%p");this.x_axis=d3.svg.axis().scale(e).orient("bottom").tickFormat(s),this.y_axis=d3.svg.axis().scale(a).orient("left").ticks(8),this.set_size(),this.data=void 0}function a(t,i){this.transition_duration=1e3,this.element_selector=t,this.padding=i,this.colour_scale=d3.scale.quantile().range(colorbrewer.Reds[7]),this.svg=d3.select(this.element_selector).append("svg"),this.svg.append("g").attr("class","x axis"),this.svg.append("g").attr("class","y axis"),this.x_scale=d3.scale.ordinal(),this.x_label_scale=d3.scale.ordinal(),this.y_scale=d3.scale.linear().nice(),this.x_axis=d3.svg.axis().scale(this.x_scale).orient("bottom").ticks(10),this.y_axis=d3.svg.axis().scale(this.y_scale).orient("left").ticks(8),this.set_size(),this.data=void 0,this.display_data=void 0,this.tooltip=d3.select(this.element_selector).append("div").attr("class","tooltip").style("position","absolute").style("z-index","10").style("visibility","hidden").style("background-color","rgba(255,255,255,0.8)").text("a simple tooltip"),this.tooltip_active=!1}t.prototype.set_size=function(){this.width=+d3.select(this.element_selector).node().getBoundingClientRect().width,this.height=+d3.select(this.element_selector).node().getBoundingClientRect().height,this.x_scale.range([this.padding.left,this.width-this.padding.right]),this.y_scale.range([this.height-this.padding.bottom,this.padding.top]),this.svg.transition().attr("height",this.height).attr("width",this.width),d3.select(".x.axis").attr("transform","translate(0,"+(this.height-this.padding.bottom)+")"),d3.select(".y.axis").attr("transform","translate("+this.padding.left+",0)")},t.prototype.add_data=function(t,i,e,a){this.set_size();var s=this;this.data=t,this.x=i,this.y=e,this.y_label=a,s.display_data=s.data.times;var n=d3.max(this.display_data,function(t){return t[s.y]});this.x_scale.domain([t.yesterday,t.now]),this.y_scale.domain([0,n]),this.colour_scale.domain([0,n])},t.prototype.draw=function(){this.set_size();var t=this,i=this.svg.selectAll(".bar").data(t.display_data);i.enter().append("rect").attr("x",function(i){return t.x_scale(new Date(i[t.x]))}).attr("y",t.height-t.padding.bottom).attr("width","3px").attr("height",0).attr("fill",function(i){return t.colour_scale(i[t.y])}).attr("class","bar"),i.transition().duration(t.transition_duration).attr("fill",function(i){return t.colour_scale(i[t.y])}).attr("width","3px").attr("x",function(i){return t.x_scale(new Date(i[t.x]))}).attr("y",function(i){return t.y_scale(i[t.y])}).attr("height",function(i){return t.height-t.padding.bottom-t.y_scale(i[t.y])}),i.exit().transition().duration(this.transition_duration).attr("y",t.height).attr("height",0).remove(),this.width<1e3?this.x_axis.ticks(d3.time.minute,80):this.width<800?this.x_axis.ticks(d3.time.minute,120):this.x_axis.ticks(d3.time.minute,30),this.svg.select(".x.axis").attr("transform","translate(0,"+(this.height-this.padding.bottom)+")").transition().duration(this.transition_duration).call(this.x_axis).selectAll("text").style("text-anchor","end").attr("dx","-.5em").attr("dy",".15em").attr("transform","rotate(-35)"),this.svg.select(".y.axis").attr("transform","translate("+this.padding.left+",0)").transition().duration(this.transition_duration).call(this.y_axis),this.svg.select(".y.axis").append("text").attr("class","y label").attr("text-anchor","end").attr("dx","-3em").attr("dy","-3em").attr("transform","rotate(-90)").text(this.y_label)},i.prototype.set_size=function(){this.width=+d3.select(this.element_selector).node().getBoundingClientRect().width,this.height=+d3.select(this.element_selector).node().getBoundingClientRect().height,this.svg.transition().attr("height",this.height).attr("width",this.width),this.cellSize=this.width/53},i.prototype.add_data=function(t){this.checkins=t},i.prototype.draw=function(){this.set_size(),this.svg.selectAll(".day").remove(),this.svg.selectAll(".month").remove();var t=this;this.rect=this.svg.selectAll(".day").data(function(t){return d3.time.days(new Date(t,0,1),new Date(t+1,0,1))}).enter().append("rect").attr("class","day").attr("fill","none").attr("stroke","#ccc").attr("width",this.cellSize).attr("height",this.cellSize).attr("x",function(i){return t.week(i)*t.cellSize}).attr("y",function(i){return t.day(i)*t.cellSize}).datum(this.format);var i=this.svg.selectAll(".month").data(function(t){return d3.time.months(new Date(t,0,1),new Date(t+1,0,1))}).enter().append("g").attr("class","month"),e=function(i){var e=new Date(i.getFullYear(),i.getMonth()+1,0),a=+t.day(i),s=+t.week(i),n=+t.day(e),r=+t.week(e);return"M"+(s+1)*t.cellSize+","+a*t.cellSize+"H"+s*t.cellSize+"V"+7*t.cellSize+"H"+r*t.cellSize+"V"+(n+1)*t.cellSize+"H"+(r+1)*t.cellSize+"V0H"+(s+1)*t.cellSize+"Z"};i.append("path").attr("d",e),i.append("text").text(function(i){return t.get_month(i.getMonth())}).attr("x",function(i){var e=+t.week(i);return(e+1)*t.cellSize}).attr("y",8*t.cellSize);for(var a in this.checkins){var s=new Date(this.checkins[a].time);s=s.toDateString(),s in this.checkin_data?this.checkin_data[s]=this.checkin_data[s]+1:this.checkin_data[s]=1}var n=0;for(var r in this.checkin_data)this.checkin_data[r]>n&&(n=this.checkin_data[r]);this.colour_scale.domain([1,n]),this.rect.filter(function(i){return new Date(i).toDateString()in t.checkin_data}).attr("fill",function(i){return t.colour_scale(t.checkin_data[new Date(i).toDateString()])})},i.prototype.get_month=function(t){return 0===t?"Jan":1===t?"Feb":2===t?"Mar":3===t?"Apr":4===t?"May":5===t?"Jun":6===t?"Jul":7===t?"Aug":8===t?"Sep":9===t?"Oct":10===t?"Nov":11===t?"Dec":void 0},i.prototype.get_day=function(t){return 0===t?"Sunday":1===t?"Monday":2===t?"Tuesday":3===t?"Wednesday":4===t?"Thursday":5===t?"Friday":6===t?"Saturday":void 0},e.prototype.set_size=function(){this.width=+d3.select(this.element_selector).node().getBoundingClientRect().width,this.height=+d3.select(this.element_selector).node().getBoundingClientRect().height;var t=200;this.width<1e3&&(t=70),this.x_scale.range([this.padding.left,this.width-this.padding.right-t],.1),this.y_scale.range([this.height-this.padding.bottom,this.padding.top]),this.svg.transition().attr("height",this.height).attr("width",this.width),d3.select(".x.axis").attr("transform","translate(0,"+(this.height-this.padding.bottom)+")"),d3.select(".y.axis").attr("transform","translate("+this.padding.left+",0)")},e.prototype.add_data=function(t,i,e,a,s,n){this.set_size(),this.y_label=n,this.data=[];var r=[];for(var o in i)-1===r.indexOf(i[o][e])&&(this.data.push({id:i[o][e],name:i[o][a],data:[],count:0}),r.push(i[o][e]));var h=new Date(t[0].time),l=new Date(t[0].time),d=0;for(var c in t){var u=null;for(var g in this.data)if(this.data[g].id===t[c][s]){u=this.data[g];break}var p=u.count,_={date:t[c].time,count:p+1};u.data.push(_),u.count+=1,new Date(t[c].time)<h&&(h=new Date(t[c].time)),new Date(t[c].time)>l&&(l=new Date(t[c].time)),u.count>d&&(d=u.count)}for(var x in this.data)this.data[x].data.push({date:l,count:this.data[x].count});this.data=this.data.sort(function(t,i){return i.count-t.count}),this.data=this.data.slice(0,7),h.setHours(h.getHours()-2),h.setMinutes(0),l.setHours(l.getHours()+2),l.setMinutes(0),this.x_scale.domain([h,l]),this.y_scale.domain([0,d+10]),this.colour_scale.domain([d,0]),this.draw()},e.prototype.draw=function(){this.set_size();var t=this;this.svg.selectAll(".line").transition().duration(this.transition_duration).attr("d","M 0,"+(this.height-this.padding.bottom)+"L "+this.padding.left+","+(this.height-this.padding.bottom)).remove(),this.svg.selectAll(".label").remove(),this.svg.selectAll(".pointer").remove();var i=this.svg.selectAll(".line").data(this.data);i.enter().append("path"),i.transition().duration(t.transition_duration).attr("class","line").attr("stroke",function(i){return t.colour_scale(i.count)}).attr("d",function(i){return t.line(i.data)});var e=this.svg.selectAll(".label").data(this.data);e.enter().append("text");var a=[];e.transition().duration(t.transition_duration).attr("class","label").attr("x",function(i){var e=d3.max(i.data,function(t){return new Date(t.date)});return t.x_scale(e)+10}).attr("y",function(i){var e=t.y_scale(i.count);if(a.length>0){var s=a[a.length-1];15>e-s&&(e=s+15)}return a.push(e),e}).attr("fill",function(i){return t.colour_scale(i.count)}).attr("stroke-width","0.3px").attr("stroke","black").text(function(t){return t.name});var s=this.svg.selectAll(".pointer").data(this.data);s.enter().append("line").attr("class","pointer").attr("x1",function(i){var e=d3.max(i.data,function(t){return new Date(t.date)});return t.x_scale(e)}).attr("y1",function(i){return t.y_scale(i.count)}).attr("x2",function(i){var e=d3.max(i.data,function(t){return new Date(t.date)});return t.x_scale(e)+8}).attr("y2",function(t,i){return a[i]-5}).attr("stroke","black").attr("stroke-width","1px"),i.exit().remove(),e.exit().remove(),this.svg.select(".x.axis").attr("transform","translate(0,"+(this.height-this.padding.bottom)+")").transition().duration(this.transition_duration).call(this.x_axis).selectAll("text").style("text-anchor","end").attr("dx","-.5em").attr("dy",".15em").attr("transform","rotate(-35)"),this.svg.select(".y.axis").attr("transform","translate("+this.padding.left+",0)").transition().duration(this.transition_duration).call(this.y_axis),this.svg.select(".y.axis").append("text").attr("class","y label").attr("text-anchor","end").attr("dx","-6em").attr("dy","-3em").attr("transform","rotate(-90)").text(this.y_label)},a.prototype.set_size=function(){this.width=+d3.select(this.element_selector).node().getBoundingClientRect().width,this.height=+d3.select(this.element_selector).node().getBoundingClientRect().height,this.x_scale.rangeRoundBands([this.padding.left,this.width-this.padding.right],.1),this.y_scale.range([this.height-this.padding.bottom,this.padding.top]),this.svg.transition().attr("height",this.height).attr("width",this.width),d3.select(".x.axis").attr("transform","translate(0,"+(this.height-this.padding.bottom)+")"),d3.select(".y.axis").attr("transform","translate("+this.padding.left+",0)"),this.width<=400?this.num_bars=10:this.width>400&&this.width<=600?this.num_bars=15:this.num_bars=20},a.prototype.add_data=function(t,i,e,a,s,n){this.set_size();var r=this;this.data=t,this.x=i,this.y=e,this.tooltip_function=n,s?(this.data.sort(function(t,i){return t[r.y]>i[r.y]?-1:t[r.y]<i[r.y]?1:0}),r.display_data=r.data.slice(0,this.num_bars)):r.display_data=r.data,this.x_labels=this.display_data.map(function(t){return t[i]});var o=d3.max(this.display_data,function(t){return t[r.y]});this.x_scale.domain(this.x_labels),this.y_scale.domain([0,o]),this.colour_scale.domain([0,o]),this.y_label=a},a.prototype.draw=function(){this.set_size();var t=this,i=this.svg.selectAll(".bar").data(t.display_data);if(i.enter().append("rect").attr("x",function(i){return t.x_scale(i[t.x])}).attr("y",t.height-t.padding.bottom).attr("width",t.x_scale.rangeBand()).attr("height",0).attr("fill",function(i){return t.colour_scale(i[t.y])}).attr("class","bar").on("mouseover",function(i){t.tooltip_function&&(t.tooltip.html(t.tooltip_function(i)),t.tooltip_active=!0,t.tooltip.style("visibility","visible"))}).on("mousemove",function(){t.tooltip_function&&t.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px")}).on("mouseout",function(){t.tooltip_function&&(t.tooltip_active=!1,t.tooltip.style("visibility","hidden"))}).on("click",function(i){t.tooltip_function&&(t.tooltip_active?(t.tooltip.style("visibility","hidden"),t.tooltip_active=!1):(t.tooltip.html(t.tooltip_function(i)),t.tooltip.style("visibility","visible"),t.tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px"),t.tooltip_active=!0))}),i.transition().duration(t.transition_duration).attr("fill",function(i){return t.colour_scale(i[t.y])}).attr("width",t.x_scale.rangeBand()).attr("x",function(i){return t.x_scale(i[t.x])}).attr("y",function(i){return t.y_scale(i[t.y])}).attr("height",function(i){return t.height-t.padding.bottom-t.y_scale(i[t.y])}),i.exit().transition().duration(this.transition_duration).attr("y",t.height).attr("height",0).remove(),this.width<600&&this.x_labels.length>20){for(var e=[],a=0;a<this.x_labels.length;a+=2)e.push(this.x_labels[a]);this.x_axis.tickValues(e)}else this.x_axis.tickValues(this.x_labels);this.svg.select(".x.axis").attr("transform","translate(0,"+(this.height-this.padding.bottom)+")").transition().duration(this.transition_duration).call(this.x_axis).selectAll("text").style("text-anchor","end").attr("dx","-.5em").attr("dy",".15em").attr("transform","rotate(-35)"),this.svg.select(".y.axis").attr("transform","translate("+this.padding.left+",0)").transition().duration(this.transition_duration).call(this.y_axis),this.svg.select(".y.axis").append("text").attr("class","y label").attr("text-anchor","end").attr("dx","-6em").attr("dy","-3em").attr("transform","rotate(-90)").text(this.y_label)},this.BarChart=a,this.DayChart=i,this.TimeLine=e,this.SingleDayChart=t}();