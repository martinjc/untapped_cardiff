---
layout: default
---

<h1 class="headline">BarDiff</h1>
<h2>The number 2 data-driven beer-dashboard in Cardiff since 2017</h2>

<div id="vis">
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/4.7.4/d3.js"></script>
<script src="//d3js.org/colorbrewer.v1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3-queue/3.0.3/d3-queue.js"></script>
<script src="js/main.js"></script>
<script>
    var q = d3.queue()
        .defer(d3.request, "http://bardifftest-martinjc.rhcloud.com/api/venues?from=2016-03-11&to=2016-03-18")
        .await(function(error, venues){
            venues = JSON.parse(venues.response);

            // extract names and count, then sort by count
            venues_data = venues.map(function(d){
                return {
                    'x': d.count,
                    'y': d.venue_name,
                    'twitter': d.contact.twitter,
                    'address': d.location.venue_address,
                    'city': d.location.venue_city,
                }
            }).sort(function(a, b){
                return +b.x - +a.x;
            });

            var venue_tooltip = function(d) {
                var text = "";
                text += d.x + " Checkins<br>";
                if(d.twitter) {
                    text += d.twitter + "<br>";
                }
                if(d.address) {
                    text += d.address + "<br>";
                }
                if(d.city) {
                    text += d.city;
                }
                return text;
            };

            var chart = barChart();

            chart
                .data(venues_data.slice(0,20))
                .width(d3.select('#vis').node().getBoundingClientRect().width)
                .height(d3.select('#vis').node().getBoundingClientRect().height)
                .x_label('Number of Checkins')
                .tooltip_function(venue_tooltip);

            d3.select('#vis')
                .call(chart);

        });
</script>
